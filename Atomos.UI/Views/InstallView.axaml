<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:Atomos.UI.ViewModels"
             x:Class="Atomos.UI.Views.InstallView"
             x:DataType="vm:InstallViewModel">
    <Grid IsVisible="{Binding IsSelectionVisible}" Background="#80000000">
        <Border Classes="installDialog"
                Width="680"
                MaxHeight="720"
                HorizontalAlignment="Center"
                VerticalAlignment="Center">
            <Grid RowDefinitions="Auto,Auto,Auto,Auto,*,Auto">
                <!-- Title with Icon -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="12" HorizontalAlignment="Center" Margin="0,0,0,20">
                    <TextBlock Text="📦" FontSize="24" VerticalAlignment="Center"/>
                    <TextBlock Text="Select Files to Extract &amp; Install"
                               FontSize="22"
                               FontWeight="Bold"
                               Foreground="{StaticResource TextBrush}"
                               VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Timeout Warning -->
                <Border Grid.Row="1" Classes="timeoutWarning" IsVisible="{Binding IsTimeoutWarning}" Margin="0,0,0,20">
                    <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center">
                        <TextBlock Text="⚠️" FontSize="16" VerticalAlignment="Center"/>
                        <TextBlock Text="Selection will timeout in"
                                   FontSize="14"
                                   FontWeight="Medium"
                                   Foreground="#FF6B47"
                                   VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding TimeoutMessage}"
                                   FontSize="14"
                                   FontWeight="Bold"
                                   Foreground="#FF6B47"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>

                <!-- Timeout Display -->
                <StackPanel Grid.Row="2" Orientation="Horizontal" 
                            Spacing="8" 
                            HorizontalAlignment="Center"
                            IsVisible="{Binding !IsTimeoutWarning}"
                            Margin="0,0,0,20">
                    <TextBlock Text="🕒" FontSize="14" VerticalAlignment="Center" Opacity="0.7"/>
                    <TextBlock Text="Time remaining:"
                               FontSize="13"
                               Foreground="{StaticResource TextBrush}"
                               Opacity="0.7"
                               VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding TimeoutMessage}"
                               FontSize="13"
                               FontWeight="Medium"
                               Foreground="{StaticResource TextBrush}"
                               Opacity="0.8"
                               VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Select All Section -->
                <StackPanel Grid.Row="3" Orientation="Horizontal" 
                            Spacing="12" 
                            HorizontalAlignment="Left" 
                            Margin="10,0,10,20"
                            IsVisible="{Binding ShowSelectAll}">
                    <CheckBox Content="Select All"
                              IsChecked="{Binding AreAllSelected}"
                              FontWeight="SemiBold"
                              Classes="selectAllCheckBox"/>
                </StackPanel>

                <!-- Files List -->
                <Border Grid.Row="4" Classes="fileListContainer">
                    <ScrollViewer>
                        <ItemsControl ItemsSource="{Binding Files}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate DataType="{x:Type vm:FileItemViewModel}">
                                    <Button Classes="fileItemButton" 
                                            Command="{Binding $parent[ItemsControl].((vm:InstallViewModel)DataContext).ToggleFileSelectionCommand}"
                                            CommandParameter="{Binding}"
                                            HorizontalContentAlignment="Stretch"
                                            VerticalContentAlignment="Stretch"
                                            Padding="0">
                                        <Border Classes="fileItem">
                                            <Grid ColumnDefinitions="Auto,*">
                                                <CheckBox Grid.Column="0"
                                                          IsChecked="{Binding IsSelected}"
                                                          VerticalAlignment="Top"
                                                          Margin="0,2,12,0"
                                                          IsHitTestVisible="False"/>
                                                <StackPanel Grid.Column="1" Spacing="2">
                                                    <TextBlock Text="{Binding FileName}"
                                                               TextWrapping="Wrap"
                                                               FontFamily="Consolas, monospace"
                                                               FontSize="13"
                                                               FontWeight="Medium"
                                                               Foreground="{StaticResource TextBrush}"/>
                                                    <TextBlock Text="{Binding FilePath}"
                                                               TextWrapping="Wrap"
                                                               FontFamily="Consolas, monospace"
                                                               FontSize="11"
                                                               Opacity="0.7"
                                                               Foreground="{StaticResource TextBrush}"/>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Border>

                <!-- Buttons -->
                <StackPanel Grid.Row="5" Orientation="Horizontal"
                            HorizontalAlignment="Right"
                            Spacing="12"
                            Margin="0,20,0,0">
                    <Button Content="Extract &amp; Install"
                            Command="{Binding InstallCommand}"
                            Width="160"
                            Classes="installButton"/>
                    <Button Content="Cancel"
                            Command="{Binding CancelCommand}"
                            Width="100"
                            Classes="cancelButton"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>